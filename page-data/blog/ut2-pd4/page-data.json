{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/ut2-pd4/","result":{"data":{"datoCmsBlogpost":{"id":"DatoCmsBlogpost-184048803","slug":"ut2-pd4","title":"Caso de estudio: Titanic","excerpt":"En este caso de estudio, se sigue una guía para realizar un análisis sobre los datos del conjunto Titanic del UCI, utilizando diferentes librerías de Python.","date":"2023-09-04","html":"### Contenido\n- [Introducción](#introduccion)\n- [Código](#codigo)\n- [Importando librerías y paquetes](#importando-librerias-y-paquetes)\n- [Cargando y visualizando los datos](#cargando-y-visualizando-los-datos)\n- [Lidiando con valores no numéricos (Imputación)](#lidiando-con-valores-no-numericos-imputacion)\n- [Graficando y visualizando datos](#graficando-y-visualizando-datos)\n- [Ingeniería de atributos](#ingenieria-de-atributos)\n- [Ajuste del modelo, optimización y predicción](#ajuste-del-modelo-optimizacion-y-prediccion)\n\n\n### Introducción\nEn este artículo, realizaremos un análisis de los datos disponibles en el conjunto \"Titanic\", publicado en [Kaggle](https://www.kaggle.com/competitions/titanic/data). Se describirá el uso de las librerías *numpy*, *pandas*, *seaborn*, *matplotlib* y *scikit-learn* para el análisis, modificación y visualización de los datos.\nLuego, produciremos un modelo de aprendizaje automático, capaz de realizar predicciones, utilizando el conjunto de datos ya procesado.\n\nEl objetivo final será generar una comprensión profunda del conjunto de datos, el problema al que están relacionados y su posible utilización en el entrenamiento de modelos de aprendizaje automático, después de su adaptación adecuada. También se buscará generar una comprensión de las herramientas de Python utilizadas para construir modelos de aprendizaje automático.\n\n### Código\nEl código utilizado para el análisis realizado en este caso de estudio está disponible en el siguiente repositorio:\n\nhttps://github.com/WalterTano/ml-titanic-py-analysis\n\n### Importando librerías y paquetes\n\nEl primer paso consiste en instalar e importar todas las librerías y paquetes necesarios para el resto del tutorial. Los paquetes que debemos instalar (es decir, no son incluidos por defecto cuando instalamos Python) son:\n\n- *numpy*\n- *pandas*\n- *seaborn*\n- *matplotlib*\n- *scikit-learn*\n\nPodemos instalarlos usando el comando ***pip*** de la siguiente manera:\n\n```bash\npip install <nombre-de-librería>\n```\n\nFinalmente, ejecutamos el código incluído en el blog para obtener la siguiente salida:\n\n![Untitled](https://www.datocms-assets.com/106983/1696363088-ut2-pd4-1.png)\n\n### Cargando y visualizando los datos\n\nEn este paso cargamos los datos desde el sistema de archivos utilizando funciones de la librería ***pandas***.\n\nAl inspeccionar las primeras filas con la función *head*, encontramos que los datos no se encuentran en un estado óptimo para la construcción de nuestro modelo, por lo que será necesario realizar preprocesamiento de los mismos.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363092-ut2-pd4-2.png)\n\n![Untitled](https://www.datocms-assets.com/106983/1696363097-ut2-pd4-3.png)\n\n### Lidiando con valores no numéricos (Imputación)\n\nAl inspeccionar los datos, podemos encontrar valores faltantes en la columna de la edad (***Age***) y el número de cabina (***cabin***) principalmente. Estos valores faltantes generarán problemas a la hora de construir nuestro modelo, por lo que necesitamos rellenarlos.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363101-ut2-pd4-4.png)\n\nEn el proceso de *emprolijar* los datos para generar el modelo, además de rellenar valores faltantes, también eliminaremos atributos complicados que no parecen añadir información a las predicciones que deseamos realizar (si el pasajero sobrevivió o no). Para esto, eliminaremos los campos ***cabin*** (que ya era muy problemático por la cantidad de valores faltantes) y ***ticket.***\n\n![Untitled](https://www.datocms-assets.com/106983/1696363106-ut2-pd4-5.png)\n\n![Untitled](https://www.datocms-assets.com/106983/1696363111-ut2-pd4-6.png)\n\nAhora solo queda rellenar los valores de edad. Para conocer más sobre estos valores, específicamente su distribución en el rango, aprovechamos la librería ***seaborn***:\n\n![Untitled](https://www.datocms-assets.com/106983/1696363116-ut2-pd4-7.png)\n\n![Figure_1.png](https://www.datocms-assets.com/106983/1696363083-ut2-pd4-figure_1.png)\n\nYa que en el gráfico podemos observar una leve inclinación hacia la derecha (es decir, los valores más altos del rango), llenaremos los valores vacíos con su mediana. Elegimos la mediana en lugar de la media porque los valores altos que se dan en la inclinación tienden a influenciar más la última, a diferencia de la primera.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363120-ut2-pd4-8.png)\n\n![Untitled](https://www.datocms-assets.com/106983/1696363124-ut2-pd4-9.png)\n\n### Graficando y visualizando datos\n\nPara tener un mejor entendimiento de los datos, su distribución y sus correlaciones, es importante ser capaces de visualizarlos adecuadamente. Aprovechando las librerías importadas, vamos a generar diferentes ilustraciones de la información disponible.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363128-ut2-pd4-10.png)\n\n![Con este diagrama de barras podemos notar inmediatamente que los pasajeros del género femenino tenían una probabilidad inmensamente mayor de sobrevivir que aquellos del género masculino.](https://www.datocms-assets.com/106983/1696363050-ut2-pd4-figure_1-1.png)\n\nCon este diagrama de barras podemos notar inmediatamente que los pasajeros del género femenino tenían una probabilidad inmensamente mayor de sobrevivir que aquellos del género masculino.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363133-ut2-pd4-11.png)\n\n![Los datos indican que casi el 70% de los pasajeros que sobrevivieron eran mujeres.](https://www.datocms-assets.com/106983/1696363137-ut2-pd4-12.png)\n\nLos datos indican que casi el 70% de los pasajeros que sobrevivieron eran mujeres.\n\nClaramente, el género es un factor clave para la predicción de supervivencia de un pasajero.\n\nA continuación, se explora la influencia del atributo ***class***.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363141-ut2-pd4-13.png)\n\n![Podemos observar que los pasajeros que tenían pasajes de mayor clase tuvieron una mayor tendencia a sobrevivir. Esto podría ser por la ubicación de sus cabinas en el barco o la prioridad a la hora de asignar botes salvavidas.](https://www.datocms-assets.com/106983/1696363055-ut2-pd4-figure_1-2.png)\n\nPodemos observar que los pasajeros que tenían pasajes de mayor clase tuvieron una mayor tendencia a sobrevivir. Esto podría ser por la ubicación de sus cabinas en el barco o la prioridad a la hora de asignar botes salvavidas.\n\n![Untitled](https://www.datocms-assets.com/106983/1696362965-ut2-pd4-14.png)\n\n![Los datos indican que, dentro de su propia clase, los pasajeros de primera y tercera clase tuvieron una mayor tendencia a sobrevivir que aquellos de segunda clase.](https://www.datocms-assets.com/106983/1696362971-ut2-pd4-15.png)\n\nLos datos indican que, dentro de su propia clase, los pasajeros de primera y tercera clase tuvieron una mayor tendencia a sobrevivir que aquellos de segunda clase.\n\n![Untitled](https://www.datocms-assets.com/106983/1696362975-ut2-pd4-16.png)\n\n![Figure_1.png](https://www.datocms-assets.com/106983/1696363060-ut2-pd4-figure_1-3.png)\n\n![Untitled](https://www.datocms-assets.com/106983/1696362980-ut2-pd4-17.png)\n\n![Figure_1.png](https://www.datocms-assets.com/106983/1696363064-ut2-pd4-figure_1-4.png)\n\nViendo como los datos son afectados por la clase de los pasajeros, también podemos concluir que es un atributo importante a la hora de predecir su supervivencia.\n\nInspeccionando profundamente el atributo de edad, podemos encontrar hallazgos interesantes:\n\n![Untitled](https://www.datocms-assets.com/106983/1696362984-ut2-pd4-18.png)\n\n![Figure_1.png](https://www.datocms-assets.com/106983/1696363068-ut2-pd4-figure_1-5.png)\n\n![Untitled](https://www.datocms-assets.com/106983/1696362990-ut2-pd4-19.png)\n\n![Figure_1.png](https://www.datocms-assets.com/106983/1696363073-ut2-pd4-figure_1-6.png)\n\nAl observar las tendencias de estos diagramas hacia los valores menores en el rango de edad, podemos concluir que los pasajeros más jovenes (entre 20 y 35 años) son quienes tuvieron la mayor tendencia a sobrevivir.\n\nFinalmente, generamos una compilación de gráficos con las relaciones entre los distintos atributos\n\n![Untitled](https://www.datocms-assets.com/106983/1696362995-ut2-pd4-20.png)\n\n![Figure_1.png](https://www.datocms-assets.com/106983/1696363077-ut2-pd4-figure_1-7.png)\n\n### Ingeniería de atributos\n\nPara poder usar estos datos en nuestro modelo, será necesario convertir los atributos ***sex*** y ***embarked*** a valores númericos. Para esto, ya que el sexo es un atributo binario, lo reemplazaremos con 1s y 0s, donde 1 es para género femenino y 0 para masculino. Por otro lado, los valores del campo ***embarked*** son 3: S, C y Q, por lo que una conversión similar es posible. A los valores mencionados anteriormente se le asignan los siguientes valores númericos respectivamente: 0, 1 y 2.\n\nPara realizar esta conversión de datos, aprovecharemos la librería *scikit-learn:*\n\n![Untitled](https://www.datocms-assets.com/106983/1696362999-ut2-pd4-21.png)\n\n![Podemos observar que los valores de los atributos ***sex*** y ***embarked*** han sido transformados a sus correspondientes númericos como definimos previamente.](https://www.datocms-assets.com/106983/1696363003-ut2-pd4-22.png)\n\nPodemos observar que los valores de los atributos ***sex*** y ***embarked*** han sido transformados a sus correspondientes númericos como definimos previamente.\n\n**Creando atributos derivados**\n\nPuede ser útil generar atributos que creemos que puedan ser de utilidad para nuestro modelo, tomando como base los datos existentes.\n\nCombinaremos los campos ***sibsip*** y ***parch*** para generar el atributo ***famsize***. Los atributos originales representan la cantidad de hermanos y hermanas y la cantidad de padres e hijos del pasajero, respectivamente. Al combinarlos en un único atributo, tendremos información general sobre la cantidad de familiares dentro del barco para cada pasajero.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363008-ut2-pd4-23.png)\n\nEn base a este atributo generado, también podemos derivar otro atributo llamado ***isalone***. Este atributo nos indicará si el pasajero abordó el barco sin compañía, lo cual puede ser relevante para su supervivencia.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363013-ut2-pd4-24.png)\n\nQuizás sea posible también extraer información de los nombres de los pasajeros, principalmente relacionado a él título que el pasajero podría haber tenido (señor, señorita, doctor, etc).\n\n![Untitled](https://www.datocms-assets.com/106983/1696363017-ut2-pd4-25.png)\n\n![Las primeras filas de los datos de entrenamiento y de prueba, con los atributos sintéticos agregados.](https://www.datocms-assets.com/106983/1696363021-ut2-pd4-26.png)\n\nLas primeras filas de los datos de entrenamiento y de prueba, con los atributos sintéticos agregados.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363026-ut2-pd4-27.png)\n\n![Podemos ver una variedad amplia de títulos y la frecuencia con la que se dan en los datos del conjunto de entrenamiento.](https://www.datocms-assets.com/106983/1696363030-ut2-pd4-28.png)\n\nPodemos ver una variedad amplia de títulos y la frecuencia con la que se dan en los datos del conjunto de entrenamiento.\n\nYa que el campo de título nuevamente se trata de un campo de texto, realizaremos una conversión de éste a un campo númerico, reemplazando los menos influyentes por el valor *“Otro”*. Los valores resultantes y su número correspondiente son: *“Señorita”* (0), *“Señor”* (1), *“Señora”* (2), *“Maestro”* (3), *“Doctor”* (4), *“Reverendo”* (5) y *“Otro”* (6).\n\n![Untitled](https://www.datocms-assets.com/106983/1696363036-ut2-pd4-29.png)\n\nHabiendo extraído esta información, el campo ***name*** se vuelve innecesario, por lo que podemos descartarlo de los conjuntos de datos.\n\n![Untitled](https://www.datocms-assets.com/106983/1696363040-ut2-pd4-30.png)\n\n![Untitled](https://www.datocms-assets.com/106983/1696363045-ut2-pd4-31.png)\n\nCon todos los atributos convertidos a valores numéricos, nuestros datos ya están técnicamente listos para utilizarlos para entrenar y probar nuestro modelo. Sin embargo, para garantizar la calidad del mismo, todavía deberíamos reescalar los valores de los campos de ***age*** y ***fare***, por su amplio rango.\n\nPodemos realizar este reescalado utilizando un StandardScaler de la librería *sklearn.preprocessing*.\n![Untitled](https://www.datocms-assets.com/106983/1697495743-ut2-pd4-32.png)\n![Untitled](https://www.datocms-assets.com/106983/1697495865-ut2-pd4-33.png)\n\n### Ajuste del modelo, optimización y predicción\nHabiendo procesado nuestros datos adecuadamente y teniendo un entendimiento profundo del problema, podemos empezar a construir nuestro modelo de aprendizaje automático. \nLa librería *sklearn* nos facilita varios algoritmos para modelos de aprendizaje automático, por lo que probaremos varios para comparar resultados y quedarnos con el de mayor eficiencia.\n\nEntre los algoritmos a utilizar se encuentran:\n- Regresión Logística \n(```from sklearn.linear_model import LogisticRegression```)\n- K Vecinos más Cercanos (K-NN)\n(```from sklearn.neighbors import KNeighborsClassifier```)\n- Naive Bayes Gaussiano\n(```from sklearn.naive_bayes import GaussianNB```)\n- Árbol de Decisiones\n(```from sklearn.tree import DecisionTreeClassifier```)\n\nPara evaluar el rendimiento de estos modelos, podemos usar las funciones *make_scorer* y *accuracy_score* de la librería *sklearn.metrics*.\n\n```\nfrom sklearn.metrics import make_scorer, accuracy_score\n```\n\nY también haremos uso de la clase *GridSearchCV* de la librería *sklearn.model_selection* para realizar validaciones cruzadas y así encontrar los parámetros óptimos para nuestro modelo para nuestro conjunto de datos de prueba.\n\nA continuación, definimos algunas variables con los atributos a usar para entrenar y probar nuestros modelos.\n\n```\nX_train = training.drop(labels=[\"PassengerId\", \"Survived\"], axis=1)\ny_train = training[\"Survived\"]\nX_test = testing.drop(\"PassengerId\", axis=1)\n```\n\nPara evitar que nuestro modelo se sobreajuste al conjunto de datos de prueba que tenemos, y para validar su eficiencia general, generaremos un tercer conjunto de datos para validación. Podemos generarlo con la función *train_test_split* de la librería *sklearn.model_selection*.\n\n```\nfrom sklearn.model_selection import train_test_split\n\nX_training, X_valid, y_training, y_valid = train_test_split(X_train, y_train, test_size=0.2, random_state=0)\n```\n\n#### Modelos\n\n##### Regresión Logística\n\n```\nlogreg_clf = LogisticRegression()\n\nparameters_logreg = {\"penalty\": [\"l2\"], \"fit_intercept\": [True, False], \"solver\": [\"newton-cg\", \"lbfgs\", \"liblinear\", \"sag\", \"saga\"],\n                     \"max_iter\": [50, 100, 200], \"warm_start\": [True, False]}\n\ngrid_logreg = GridSearchCV(logreg_clf, parameters_logreg, scoring=make_scorer(accuracy_score))\ngrid_logreg.fit(X_training, y_training)\n\nlogreg_clf = grid_logreg.best_estimator_\n\nlogreg_clf.fit(X_training, y_training)\npred_logreg = logreg_clf.predict(X_valid)\nacc_logreg = accuracy_score(y_valid, pred_logreg)\n```\n\n##### K Vecinos más Cercanos (K-NN)\n\n```\nknn_clf = KNeighborsClassifier()\n\nparameters_knn = {\"n_neighbors\": [3, 5, 10, 15], \"weights\": [\"uniform\", \"distance\"], \"algorithm\": [\"auto\", \"ball_tree\", \"kd_tree\"],\n                  \"leaf_size\": [20, 30, 50]}\n\ngrid_knn = GridSearchCV(knn_clf, parameters_knn, scoring=make_scorer(accuracy_score))\ngrid_knn.fit(X_training, y_training)\n\nknn_clf = grid_knn.best_estimator_\n\nknn_clf.fit(X_training, y_training)\npred_knn = knn_clf.predict(X_valid)\nacc_knn = accuracy_score(y_valid, pred_knn)\n```\n\n##### Naive Bayes Gaussiano\n\n```\ngnb_clf = GaussianNB()\n\nparameters_gnb = {}\n\ngrid_gnb = GridSearchCV(gnb_clf, parameters_gnb, scoring=make_scorer(accuracy_score))\ngrid_gnb.fit(X_training, y_training)\n\ngnb_clf = grid_gnb.best_estimator_\n\ngnb_clf.fit(X_training, y_training)\npred_gnb = gnb_clf.predict(X_valid)\nacc_gnb = accuracy_score(y_valid, pred_gnb)\n```\n\n##### Árbol de Decisiones\n\n```\ndt_clf = DecisionTreeClassifier()\n\nparameters_dt = {\"criterion\": [\"gini\", \"entropy\"], \"splitter\": [\"best\", \"random\"], \"max_features\": [\"auto\", \"sqrt\", \"log2\"]}\n\ngrid_dt = GridSearchCV(dt_clf, parameters_dt, scoring=make_scorer(accuracy_score))\ngrid_dt.fit(X_training, y_training)\n\ndt_clf = grid_dt.best_estimator_\n\ndt_clf.fit(X_training, y_training)\npred_dt = dt_clf.predict(X_valid)\nacc_dt = accuracy_score(y_valid, pred_dt)\n```\n\n#### Resultados\n\n```\nmodel_performance = pd.DataFrame({\n    \"Modelo\": [\n        \"Regresión Logística\", \n        \"K Vecinos más Cercanos\", \n        \"Naive Bayes Gaussiano\",  \n        \"Árbol de Decisiones\"\n    ],\n    \"Precisión\": [ acc_logreg, acc_knn, acc_gnb, acc_dt ]\n})\n\nprint(model_performance.sort_values(by=\"Precisión\", ascending=False))\n```\n\n```\n                   Modelo   Precisión\n0     Regresión Logística   0.804469\n2   Naive Bayes Gaussiano   0.776536\n3     Árbol de Decisiones   0.770950\n1  K Vecinos más Cercanos   0.765363\n```\n\nComo podemos ver, con una precisión del 80% en las predicciones, el mejor modelo de los elegidos para realizar predicciones sobre este problema sería el de Regresión Logística.","isMarkdown":true,"image":{"url":"https://www.datocms-assets.com/106983/1696363077-ut2-pd4-figure_1-7.png?auto=format","gatsbyImageData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/106983/1696363077-ut2-pd4-figure_1-7.png?auto=format&w=1920","srcSet":"https://www.datocms-assets.com/106983/1696363077-ut2-pd4-figure_1-7.png?auto=format&dpr=0.25&w=1920 480w,\nhttps://www.datocms-assets.com/106983/1696363077-ut2-pd4-figure_1-7.png?auto=format&dpr=0.5&w=1920 960w,\nhttps://www.datocms-assets.com/106983/1696363077-ut2-pd4-figure_1-7.png?auto=format&w=1920 1920w","sizes":"(min-width: 1920px) 1920px, 100vw"}},"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAUCAIAAABu7dhfAAAAAXNSR0IArs4c6QAABL1JREFUSEtNlUuPHMcRhCOyqrpnZmeXL4mCbQgy4KNuPvv/H3wwfLVhWADlB0iR0nJ3Z6e7KzPDh5qh1cdGITPqy8gountE1Fpx/SSkVI0CAGyeAKZqPXKqxSN//PDw7uPJPX7/9vbbt3cCuieh3VwBdM8UMvMwNwD3p+XfH5++e3t3s29GSrB1Xd3dSBIkjJeuuipIKSVJkQIUqfPa3308/fXd/X8+nSITwPPa1x6ZGue7B4AeMRT/8P5p2XqEAJCs8zw/L+sP7z9Lo5ne3O6O+ykzR0teuwLKFCQArw7t1b6+Ok6SJBVj98hMwiCQkGSElK3wt6/3rVhmZoI0RoR7eAIcWAFo7fHyOKcu/zJFYmjM1NZjHCfRql2FyUiSo7AEIwFEhodItmJmBFndneRhvs6SeF76h/vzq9u9QWuPTw/n33111BW0Gfa7So5Ol+tzKAIkmZmRX+ZC2tQKdClAsk7TtKzbsvSUCI4qL29aZkiSkpB7AJBgRkk/Py7rFiAI3h3aPNVISarFjPRIM2aKJIll8+65m+rUrBjNCjNz27ZkGUgBFLNaeNXIlAwAQTJCvzwt+6mmNP7NzWiEAF5Ijma6ct66k3blDw4+EiIyMkPyvPjzCyj3+PS4ROrzafXMD/fPw70e6ZEpQchfWVzD77/yvEf2cVSSVEnS2Bc3Y6QAFNYuftHlkZCUishCfvPyUIzjHgQkLFuvxazY0LlubmZTLZlJs2Xz8+p3NzOAYgRQI3xZ+5///lOP3Dwl/PEPX719eZhJAQLWHrUayVqsVmvVSuFuRIeU0tN58+iv7/bVCGDZQoicVc2M+PSw/OUfP/3p+9+8eXEgCdCKlRTWHq3Yi30DtG4+piMJEkkDxxg0mAmfHs6n8xYpCcWYqfunZd0cwMVEnrWYGeZWXh9nM2bm2OmLfTaXGVu13pPGWljsAjYlXvqBhEdK8lCtVo0k1p7FRnjRyGGEIYVkdyetGsHhebPee/f8fFrPq58WXz0AALRhOHJchSQIMxPw4f758XmLkAAzi1Qp1mopZiRTiMR1Seih8+oiMzFq1tZa96DZFonIoc6IzMueDFOS8JA1KEXg/rQ8PK+Hub6+3WfmuvncyoiEdXMzAtg6BuGPD2f3OB4m0sAcYLsVI+mRBEdC1nIBGyled45k9zAS5NajFhoZmcNcw5P//O/nr18cbvZN0jgvoRYDQcDMxnMTD4/rqA7guGs3+8ZrhkWmEVbooalRwv1peTz3uZVW7cXNLKF7RmqqBcDm6ZlDH8mtx8NzP+7bYddolFBJTlO7pV3ckdo1M34JxUuyAzCDhFK4n6uATBnZPVu1yThSXsKLm+m09MOutWKD1tyKGYxjB8Deu3vUWlMqZpJGQo55YEQB0IphLAkAoEdWMxIEeuQgxstbKwyIwtiNck0JSWZWzeiZ/3r/+f5pK8aUvv36eNxP+6kOr5/O3Yz1MEVkLeyePz+c//bjLyTf3O2+++auR0bk7WEuRjM+Pm8pTbXu5hKpdfN5qvb/pwaU1D0en9fn8xIZu3k+zK0VA+Tu0zRFimQxLuu2380RuWxxWrqHt1qP+za1KsG9T62VYh5J0t1LsVrK1r2UkuFmBmCapv8B2WyjoFpx7HoAAAAASUVORK5CYII="},"width":1920,"height":1015},"alt":null}}},"pageContext":{"id":"DatoCmsBlogpost-184048803"}},"staticQueryHashes":["1987388502","3342712670"],"slicesMap":{"footer":"footer","header":"header"}}